<!-- chatyourdocs/src/app/components/users/users.html -->
<div class="users-wrapper">
  <div class="users-container">
    <h1>All Registered Users</h1>

    <div *ngIf="error" class="error-message">
      <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      {{ error }}
    </div>

    <div *ngIf="!users.length && !error" class="empty-state">
      No users found.
    </div>

    <div class="actions">
      <button class="add-user-btn" [routerLink]="['/dashboard/users/adduser']">+ Add New User</button>
    </div>

    <div class="users-table" *ngIf="users.length">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
            <th *ngIf="isAdmin">Actions</th> <!-- âœ… only show if current user is ADMIN -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of users">
            <td>{{ u.id }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.roles.includes('ADMIN') ? 'ADMIN' : u.roles.join(', ') }}</td>
            <td *ngIf="isAdmin">
              <!-- Check if the row user is the current logged-in admin -->
              <button 
                *ngIf="decodedId !== u.id" 
                class="delete-btn" 
                (click)="deleteUser(u.id)">
                Delete
              </button>
              <span *ngIf="decodedId === u.id" class="cannot-delete">You !</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
